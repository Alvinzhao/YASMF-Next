<!DOCTYPE html><html lang="en"><head><title>util/fileManager</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="util/fileManager"><meta name="groc-project-path" content="lib/yasmf/util/fileManager.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/yasmf/util/fileManager.js</div></div><div id="document"><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Module fileManager.js author Kerri Shotts and version 0.4
<code>Copyright (c) 2013 Kerri Shotts, photoKandy Studios LLC
Permission is hereby granted, free of charge, to any person obtaining a copy of this
software and associated documentation files (the &quot;Software&quot;), to deal in the Software
without restriction, including without limitation the rights to use, copy, modify,
merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to the following
conditions:
The above copyright notice and this permission notice shall be included in all copies
or substantial portions of the Software.
THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.</code></span></p>
<p>FileManager implements methods that interact with the HTML5 API</p></div></div><div class="code"><div class="wrapper"><span class="hljs-comment">/*globals define, Q, LocalFileSystem, console, window, navigator, FileReader*/</span>
define( [ <span class="hljs-string">"Q"</span>, <span class="hljs-string">"yasmf/util/object"</span> ], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( Q, BaseObject )</span> </span>{
<span class="hljs-pi">  "use strict"</span>;
  <span class="hljs-keyword">var</span> IN_YASMF = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> ( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( Q, BaseObject, globalContext )</span> </span>{</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} Promise</span></p>
<p>Defined by Q, actually, but defined here to make type handling nicer</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> DEBUG = <span class="hljs-literal">false</span>;</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _requestQuota</span></p>
<p>Requests a quota from the file system</p>
<p>Parameters:</p>
<ul>
<li><p><strong>fileSystemType must be a *.</strong><br/>(PERSISTENT or TEMPORARY)</p>
</li>
<li><p><strong>requestedDataSize must be a Number.</strong><br/>(The quota we&#39;re asking for)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_requestQuota</span><span class="hljs-params">( fileSystemType, requestedDataSize )</span> </span>{
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestQuota: "</span>, fileSystemType, requestedDataSize ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">try</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>attempt to ask for a quota</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> PERSISTENT = ( <span class="hljs-keyword">typeof</span> LocalFileSystem !== <span class="hljs-string">"undefined"</span> ) ? LocalFileSystem.PERSISTENT : <span class="hljs-built_in">window</span>.PERSISTENT,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Chrome has <code>webkitPersistentStorage</code> and <code>navigator.webkitTemporaryStorage</code></p></div></div><div class="code"><div class="wrapper">          storageInfo = fileSystemType === PERSISTENT ? navigator.webkitPersistentStorage : navigator.webkitTemporaryStorage;
        <span class="hljs-keyword">if</span> ( storageInfo ) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>now make sure we can request a quota</p></div></div><div class="code"><div class="wrapper">          <span class="hljs-keyword">if</span> ( storageInfo.requestQuota ) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>request the quota</p></div></div><div class="code"><div class="wrapper">            storageInfo.requestQuota( requestedDataSize, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( grantedBytes )</span> </span>{
              <span class="hljs-keyword">if</span> ( DEBUG ) {
                <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestQuota: quota granted: "</span>, fileSystemType,
                  grantedBytes
                ].join( <span class="hljs-string">" "</span> ) );
              }
              deferred.resolve( grantedBytes );
            }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
              <span class="hljs-keyword">if</span> ( DEBUG ) {
                <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestQuota: quota rejected: "</span>, fileSystemType,
                  requestedDataSize, anError
                ].join( <span class="hljs-string">" "</span> ) );
              }
              deferred.reject( anError );
            } );
          } <span class="hljs-keyword">else</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>not everything supports asking for a quota -- like Cordova.
Instead, let&#39;s assume we get permission</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">if</span> ( DEBUG ) {
              <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestQuota: couldn't request quota -- no requestQuota: "</span>,
                fileSystemType, requestedDataSize
              ].join( <span class="hljs-string">" "</span> ) );
            }
            deferred.resolve( requestedDataSize );
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> ( DEBUG ) {
            <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestQuota: couldn't request quota -- no storageInfo: "</span>,
              fileSystemType, requestedDataSize
            ].join( <span class="hljs-string">" "</span> ) );
          }
          deferred.resolve( requestedDataSize );
        }
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _requestFileSystem</span></p>
<p>Request a file system with the requested size (obtained first by getting a quota)</p>
<p>Parameters:</p>
<ul>
<li><p><strong>fileSystemType must be a *.</strong><br/>(TEMPORARY or PERSISTENT)</p>
</li>
<li><p><strong>requestedDataSize must be a Number.</strong><br/>(The quota)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_requestFileSystem</span><span class="hljs-params">( fileSystemType, requestedDataSize )</span> </span>{
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestFileSystem: "</span>, fileSystemType, requestedDataSize ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">try</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>fix issue #2 by chasen where using <code>webkitRequestFileSystem</code> was having problems
on Android 4.2.2</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> requestFileSystem = <span class="hljs-built_in">window</span>.requestFileSystem || <span class="hljs-built_in">window</span>.webkitRequestFileSystem;
        requestFileSystem( fileSystemType, requestedDataSize, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theFileSystem )</span> </span>{
          <span class="hljs-keyword">if</span> ( DEBUG ) {
            <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestFileSystem: got a file system"</span>, theFileSystem ].join( <span class="hljs-string">" "</span> ) );
          }
          deferred.resolve( theFileSystem );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          <span class="hljs-keyword">if</span> ( DEBUG ) {
            <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_requestFileSystem: couldn't get a file system"</span>,
              fileSystemType
            ].join( <span class="hljs-string">" "</span> ) );
          }
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _resolveLocalFileSystemURL</span></p>
<p>Resolves theURI to a fileEntry or directoryEntry, if possible.
If <code>theURL</code> contains <code>private</code> or <code>localhost</code> as its first element, it will be removed. If
<code>theURL</code> does not have a URL scheme, <code>file://</code> will be assumed.</p>
<p>Parameters:</p>
<ul>
<li><strong>theURL must be a String.</strong><br/>(the path, should start with file://, but if it doesn&#39;t we&#39;ll add it.)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_resolveLocalFileSystemURL</span><span class="hljs-params">( theURL )</span> </span>{
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_resolveLocalFileSystemURL: "</span>, theURL ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">try</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>split the parts of the URL</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> parts = theURL.split( <span class="hljs-string">":"</span> ),
          protocol, path;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>can only have two parts</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> ( parts.length &gt; <span class="hljs-number">2</span> ) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"The URI is not well-formed; missing protocol: "</span> + theURL );
        }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if only one part, we assume <code>file</code> as the protocol</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> ( parts.length &lt; <span class="hljs-number">2</span> ) {
          protocol = <span class="hljs-string">"file"</span>;
          path = parts[ <span class="hljs-number">0</span> ];
        } <span class="hljs-keyword">else</span> {
          protocol = parts[ <span class="hljs-number">0</span> ];
          path = parts[ <span class="hljs-number">1</span> ];
        }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>split the path components</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> pathComponents = path.split( <span class="hljs-string">"/"</span> ),
          newPathComponents = [];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>iterate over each component and trim as we go</p></div></div><div class="code"><div class="wrapper">        pathComponents.forEach( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( part )</span> </span>{
          part = part.trim();
          <span class="hljs-keyword">if</span> ( part !== <span class="hljs-string">""</span> ) { <span class="hljs-comment">// remove /private if it is the first item in the new array, for iOS sake</span>
            <span class="hljs-keyword">if</span> ( !( ( part === <span class="hljs-string">"private"</span> || part === <span class="hljs-string">"localhost"</span> ) &amp;&amp; newPathComponents.length === <span class="hljs-number">0</span> ) ) {
              newPathComponents.push( part );
            }
          }
        } );</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>rejoin the path components</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-keyword">var</span> theNewURI = newPathComponents.join( <span class="hljs-string">"/"</span> );</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>add the protocol</p></div></div><div class="code"><div class="wrapper">        theNewURI = protocol + <span class="hljs-string">":///"</span> + theNewURI;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>and resolve the URL.</p></div></div><div class="code"><div class="wrapper">        <span class="hljs-built_in">window</span>.resolveLocalFileSystemURL( theNewURI, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theEntry )</span> </span>{
          deferred.resolve( theEntry );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _getDirectoryEntry typedef {{}} DirectoryEntry
HTML5 File API Directory Type
Returns a directory entry based on the path from the parent using
the specified options, if specified. <code>options</code> takes the form:
<code>{create: true/false, exclusive true/false }</code></span></p>
<p>Parameters:</p>
<ul>
<li><p><strong>parent must be a DirectoryEntry.</strong><br/>(The parent that path is relative from (or absolute))</p>
</li>
<li><p><strong>path must be a String.</strong><br/>(The relative or absolute path or a {DirectoryEntry})</p>
</li>
<li><p><strong>options must be an Object.</strong><br/>(The options (that is, create the directory if it doesn&#39;t exist, etc.))</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getDirectoryEntry</span><span class="hljs-params">( parent, path, options )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_getDirectoryEntry:"</span>, parent, path, options ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> path === <span class="hljs-string">"object"</span> ) {
          deferred.resolve( path );
        } <span class="hljs-keyword">else</span> {
          parent.getDirectory( path, options || {}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
            deferred.resolve( theDirectoryEntry );
          }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } );
        }
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method getFileEntry</span></p>
<p>Returns a file entry based on the path from the parent using
the specified options. <code>options</code> takes the form of <code>{ create: true/false, exclusive: true/false}</code></p>
<p>Parameters:</p>
<ul>
<li><p><strong>parent must be a DirectoryEntry.</strong><br/>(The parent that path is relative from (or absolute))</p>
</li>
<li><p><strong>path must be a String.</strong><br/>(The relative or absolute path)</p>
</li>
<li><p><strong>options must be an Object.</strong><br/>(The options (that is, create the file if it doesn&#39;t exist, etc.))</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getFileEntry</span><span class="hljs-params">( parent, path, options )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_getFileEntry:"</span>, parent, path, options ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> path === <span class="hljs-string">"object"</span> ) {
          deferred.resolve( path );
        } <span class="hljs-keyword">else</span> {
          parent.getFile( path, options || {}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theFileEntry )</span> </span>{
            deferred.resolve( theFileEntry );
          }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } );
        }
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _getFileObject typedef {{}} FileEntry
HTML5 File API File Entry
Returns a file object based on the file entry.</span></p>
<p>Parameters:</p>
<ul>
<li><strong>fileEntry must be a FileEntry.</strong><br/>(The file Entry)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getFileObject</span><span class="hljs-params">( fileEntry )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_getFileObject:"</span>, fileEntry ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        fileEntry.file( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theFile )</span> </span>{
          deferred.resolve( theFile );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _readFileContents</span></p>
<p>Reads the file contents from a file object. readAsKind indicates how
to read the file (&quot;Text&quot;, &quot;DataURL&quot;, &quot;BinaryString&quot;, &quot;ArrayBuffer&quot;).</p>
<p>Parameters:</p>
<ul>
<li><p><strong>fileObject must be a File.</strong><br/>(File to read)</p>
</li>
<li><p><strong>readAsKind must be a String.</strong><br/>(&quot;Text&quot;, &quot;DataURL&quot;, &quot;BinaryString&quot;, &quot;ArrayBuffer&quot;)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_readFileContents</span><span class="hljs-params">( fileObject, readAsKind )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_readFileContents:"</span>, fileObject, readAsKind ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> fileReader = <span class="hljs-keyword">new</span> FileReader();
        fileReader.onloadend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( e )</span> </span>{
          deferred.resolve( e.target.result );
        };
        fileReader.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        };
        fileReader[ <span class="hljs-string">"readAs"</span> + readAsKind ]( fileObject );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _createFileWriter</span></p>
<p>Creates a file writer for the file entry; <code>fileEntry</code> must exist</p>
<p>Parameters:</p>
<ul>
<li><strong>fileEntry must be a FileEntry.</strong><br/>(The file entry to write to)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(the Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createFileWriter</span><span class="hljs-params">( fileEntry )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_createFileWriter:"</span>, fileEntry ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> fileWriter = fileEntry.createWriter( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theFileWriter )</span> </span>{
          deferred.resolve( theFileWriter );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _writeFileContents typedef {{}} FileWriter
HTML5 File API File Writer Type
Write the contents to the fileWriter; <code>contents</code> should be a Blob.</span></p>
<p>Parameters:</p>
<ul>
<li><p><strong>fileWriter must be a FileWriter.</strong><br/>(Obtained from _createFileWriter)</p>
</li>
<li><p><strong>contents must be a *.</strong><br/>(The contents to write)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(the Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_writeFileContents</span><span class="hljs-params">( fileWriter, contents )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_writeFileContents:"</span>, fileWriter, contents ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        fileWriter.onwrite = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( e )</span> </span>{
          fileWriter.onwrite = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( e )</span> </span>{
            deferred.resolve( e );
          };
          fileWriter.write( contents );
        };
        fileWriter.onError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        };
        fileWriter.truncate( <span class="hljs-number">0</span> ); <span class="hljs-comment">// clear out the contents, first</span>
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _copyFile</span></p>
<p>Copy the file to the specified parent directory, with an optional new name</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to copy)</p>
</li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to copy the file to)</p>
</li>
<li><p><strong>theNewName must be a String.</strong><br/>(The new name of the file ( or undefined simply to copy ))</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_copyFile</span><span class="hljs-params">( theFileEntry, theParentDirectoryEntry, theNewName )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_copyFile:"</span>, theFileEntry, theParentDirectoryEntry,
          theNewName
        ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        theFileEntry.copyTo( theParentDirectoryEntry, theNewName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theNewFileEntry )</span> </span>{
          deferred.resolve( theNewFileEntry );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _moveFile</span></p>
<p>Move the file to the specified parent directory, with an optional new name</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to move or rename)</p>
</li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to move the file to (or the same as the file in order to rename))</p>
</li>
<li><p><strong>theNewName must be a String.</strong><br/>(The new name of the file ( or undefined simply to move ))</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_moveFile</span><span class="hljs-params">( theFileEntry, theParentDirectoryEntry, theNewName )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_moveFile:"</span>, theFileEntry, theParentDirectoryEntry,
          theNewName
        ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        theFileEntry.moveTo( theParentDirectoryEntry, theNewName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theNewFileEntry )</span> </span>{
          deferred.resolve( theNewFileEntry );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _removeFile</span></p>
<p>Remove the file from the file system</p>
<p>Parameters:</p>
<ul>
<li><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to remove)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_removeFile</span><span class="hljs-params">( theFileEntry )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_removeFile:"</span>, theFileEntry ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        theFileEntry.remove( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>{
          deferred.resolve();
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _copyDirectory</span></p>
<p>Copies a directory to the specified directory, with an optional new name. The directory
is copied recursively.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to copy)</p>
</li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to copy the first directory to)</p>
</li>
<li><p><strong>theNewName must be a String.</strong><br/>(The optional new name for the directory)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(A promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_copyDirectory</span><span class="hljs-params">( theDirectoryEntry, theParentDirectoryEntry, theNewName )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_copyDirectory:"</span>, theDirectoryEntry,
          theParentDirectoryEntry,
          theNewName
        ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        theDirectoryEntry.copyTo( theParentDirectoryEntry, theNewName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theNewDirectoryEntry )</span> </span>{
          deferred.resolve( theNewDirectoryEntry );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _moveDirectory</span></p>
<p>Moves a directory to the specified directory, with an optional new name. The directory
is moved recursively.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to move)</p>
</li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to move the first directory to)</p>
</li>
<li><p><strong>theNewName must be a String.</strong><br/>(The optional new name for the directory)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(A promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_moveDirectory</span><span class="hljs-params">( theDirectoryEntry, theParentDirectoryEntry, theNewName )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_moveDirectory:"</span>, theDirectoryEntry,
          theParentDirectoryEntry,
          theNewName
        ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        theDirectoryEntry.moveTo( theParentDirectoryEntry, theNewName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theNewDirectoryEntry )</span> </span>{
          deferred.resolve( theNewDirectoryEntry );
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _removeDirectory</span></p>
<p>Removes a directory from the file system. If recursively is true, the directory is removed
recursively.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to remove)</p>
</li>
<li><p><strong>recursively must be a Boolean.</strong><br/>(If true, remove recursively)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_removeDirectory</span><span class="hljs-params">( theDirectoryEntry, recursively )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_removeDirectory:"</span>, theDirectoryEntry, <span class="hljs-string">"recursively"</span>,
          recursively
        ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> deferred = Q.defer();
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> ( !recursively ) {
          theDirectoryEntry.remove( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>{
            deferred.resolve();
          }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } );
        } <span class="hljs-keyword">else</span> {
          theDirectoryEntry.removeRecursively( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>{
            deferred.resolve();
          }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } );
        }
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _readDirectoryContents</span></p>
<p>Reads the contents of a directory</p>
<p>Parameters:</p>
<ul>
<li><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to list)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_readDirectoryContents</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
      <span class="hljs-keyword">if</span> ( DEBUG ) {
        <span class="hljs-built_in">console</span>.log( [ <span class="hljs-string">"_readDirectoryContents:"</span>, theDirectoryEntry ].join( <span class="hljs-string">" "</span> ) );
      }
      <span class="hljs-keyword">var</span> directoryReader = theDirectoryEntry.createReader(),
        entries = [],
        deferred = Q.defer();

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readEntries</span><span class="hljs-params">()</span> </span>{
        directoryReader.readEntries( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">( theEntries )</span> </span>{
          <span class="hljs-keyword">if</span> ( !theEntries.length ) {
            deferred.resolve( entries );
          } <span class="hljs-keyword">else</span> {
            entries = entries.concat( <span class="hljs-built_in">Array</span>.prototype.slice.call( theEntries || [], <span class="hljs-number">0</span> ) );
            readEntries();
          }
        }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">failure</span><span class="hljs-params">( anError )</span> </span>{
          deferred.reject( anError );
        } );
      }
      <span class="hljs-keyword">try</span> {
        readEntries();
      } <span class="hljs-keyword">catch</span> ( anError ) {
        deferred.reject( anError );
      }
      <span class="hljs-keyword">return</span> deferred.promise;
    }</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> class FileManager</span></p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">var</span> _className = <span class="hljs-string">"UTIL.FileManager"</span>,
      FileManager = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> self,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>determine if we have a <code>BaseObject</code> available or not</p></div></div><div class="code"><div class="wrapper">          hasBaseObject = ( <span class="hljs-keyword">typeof</span> BaseObject !== <span class="hljs-string">"undefined"</span> );
        <span class="hljs-keyword">if</span> ( hasBaseObject ) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if we do, subclass it</p></div></div><div class="code"><div class="wrapper">          self = <span class="hljs-keyword">new</span> BaseObject();
          self.subclass( _className );
          self.registerNotification( <span class="hljs-string">"changedCurrentWorkingDirectory"</span> );
        } <span class="hljs-keyword">else</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>otherwise, base off {}</p></div></div><div class="code"><div class="wrapper">          self = {};
        }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>get the persistent and temporary filesystem constants</p></div></div><div class="code"><div class="wrapper">        self.PERSISTENT = ( <span class="hljs-keyword">typeof</span> LocalFileSystem !== <span class="hljs-string">"undefined"</span> ) ? LocalFileSystem.PERSISTENT : <span class="hljs-built_in">window</span>.PERSISTENT;
        self.TEMPORARY = ( <span class="hljs-keyword">typeof</span> LocalFileSystem !== <span class="hljs-string">"undefined"</span> ) ? LocalFileSystem.TEMPORARY : <span class="hljs-built_in">window</span>.TEMPORARY;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>determine the various file types we support</p></div></div><div class="code"><div class="wrapper">        self.FILETYPE = {
          TEXT: <span class="hljs-string">"Text"</span>,
          DATA_URL: <span class="hljs-string">"DataURL"</span>,
          BINARY: <span class="hljs-string">"BinaryString"</span>,
          ARRAY_BUFFER: <span class="hljs-string">"ArrayBuffer"</span>
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getGlobalDebug</span></p>
<p>Returns the value of the global <code>DEBUG</code> variable.</p>
<p><strong>Returns a Boolean</strong></p></div></div><div class="code"><div class="wrapper">        self.getGlobalDebug = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> DEBUG;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method setGlobalDebug</span></p>
<p>Sets the global DEBUG variable. If <code>true</code>, debug messages are logged to the console.</p>
<p>Parameters:</p>
<ul>
<li><strong>debug must be a Boolean.</strong></li>
</ul></div></div><div class="code"><div class="wrapper">        self.setGlobalDebug = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( debug )</span> </span>{
          DEBUG = debug;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property globalDebug of type <em>{Boolean} If <code>true</code>, logs messages to console as operations occur.</em></span></p></div></div><div class="code"><div class="wrapper">        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"globalDebug"</span>, {
          get: self.getGlobalDebug,
          set: self.setGlobalDebug,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property fileSystemType of type <em>FileSystem</em></span></p>
<p>the fileSystemType can either be <code>self.PERSISTENT</code> or <code>self.TEMPORARY</code>, and is only
set during an <code>init</code> operation. It cannot be set at any other time.</p></div></div><div class="code"><div class="wrapper">        self._fileSystemType = <span class="hljs-literal">null</span>; <span class="hljs-comment">// can only be changed during INIT</span>
        self.getFileSystemType = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> self._fileSystemType;
        };
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"fileSystemType"</span>, {
          get: self.getFileSystemType,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property requestedQuota of type <em>Number</em></span></p>
<p>The requested quota -- stored for future reference, since we ask for it
specifically during an <code>init</code> operation. It cannot be changed.</p></div></div><div class="code"><div class="wrapper">        self._requestedQuota = <span class="hljs-number">0</span>; <span class="hljs-comment">// can only be changed during INIT</span>
        self.getRequestedQuota = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> self._requestedQuota;
        };
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"requestedQuota"</span>, {
          get: self.getRequestedQuota,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property actualQuota of type <em>Number</em></span></p>
<p>The actual quota obtained from the system. It cannot be changed, and is
only obtained during <code>init</code>. The result does not have to match the
<code>requestedQuota</code>. If it doesn&#39;t match, it may be representative of the
actual space available, depending on the platform</p></div></div><div class="code"><div class="wrapper">        self._actualQuota = <span class="hljs-number">0</span>;
        self.getActualQuota = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> self._actualQuota;
        };
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"actualQuota"</span>, {
          get: self.getActualQuota,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property fileSystem typedef {{}} FileSystem
HTML5 File API File System
The current filesystem -- either the temporary or persistent one; it can&#39;t be changed and of type <em>FileSystem</em></span></p></div></div><div class="code"><div class="wrapper">        self._fileSystem = <span class="hljs-literal">null</span>;
        self.getFileSystem = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> self._fileSystem;
        };
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"fileSystem"</span>, {
          get: self.getFileSystem,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Property cwd of type <em>DirectoryEntry</em></span></p>
<p>Current Working Directory Entry</p></div></div><div class="code"><div class="wrapper">        self._root = <span class="hljs-literal">null</span>;
        self._cwd = <span class="hljs-literal">null</span>;
        self.getCurrentWorkingDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">return</span> self._cwd;
        };
        self.setCurrentWorkingDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theCWD )</span> </span>{
          self._cwd = theCWD;
          <span class="hljs-keyword">if</span> ( hasBaseObject ) {
            self.notify( <span class="hljs-string">"changedCurrentWorkingDirectory"</span> );
          }
        };
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"cwd"</span>, {
          get: self.getCurrentWorkingDirectory,
          set: self.setCurrentWorkingDirectory,
          configurable: <span class="hljs-literal">true</span>
        } );
        <span class="hljs-built_in">Object</span>.defineProperty( self, <span class="hljs-string">"currentWorkingDirectory"</span>, {
          get: self.getCurrentWorkingDirectory,
          set: self.setCurrentWorkingDirectory,
          configurable: <span class="hljs-literal">true</span>
        } );</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private property <em>cwds of type _Array</em></span></p>
<p>Current Working Directory stack</p></div></div><div class="code"><div class="wrapper">        self._cwds = [];</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method pushCurrentWorkingDirectory</span></p>
<p>Push the current working directory on to the stack</p></div></div><div class="code"><div class="wrapper">        self.pushCurrentWorkingDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          self._cwds.push( self._cwd );
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method popCurrentWorkingDirectory</span></p>
<p>Pop the topmost directory on the stack and change to it</p></div></div><div class="code"><div class="wrapper">        self.popCurrentWorkingDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          self.setCurrentWorkingDirectory( self._cwds.pop() );
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Resolves a URL to a local file system. If the URL scheme is not present, <code>file</code>
is assumed.</p>
<p>Parameters:</p>
<ul>
<li><strong>theURI must be a String.</strong><br/>(The URI to resolve)</li>
</ul></div></div><div class="code"><div class="wrapper">        self.resolveLocalFileSystemURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theURI )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _resolveLocalFileSystemURL( theURI ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotEntry</span><span class="hljs-params">( theEntry )</span> </span>{
            deferred.resolve( theEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getFileEntry</span></p>
<p>Returns the file entry for the given path (useful for
getting the full path of a file). <code>options</code> is of the
form <code>{create: true/false, exclusive: true/false}</code></p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong><br/>(The file path or FileEntry object)</p>
</li>
<li><p><strong>options must be a *.</strong><br/>(creation options)</p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getFileEntry = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFileEntry</span><span class="hljs-params">( theFileEntry )</span> </span>{
            deferred.resolve( theFileEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getFile</span></p>
<p>Returns the file object for a given file (useful for getting
the size of a file); <code>option</code> is of the form <code>{create: true/false, exclusive: true/false}</code></p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong></p>
</li>
<li><p><strong>option must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options )</span> </span>{
          <span class="hljs-keyword">return</span> self.getFileEntry( theFilePath, options ).then( _getFileObject );
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getDirectoryEntry</span></p>
<p>Returns the directory entry for a given path</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryPath must be a String.</strong></p>
</li>
<li><p><strong>options must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getDirectoryEntry = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theDirectoryPath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, theDirectoryPath, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectoryEntry</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
            deferred.resolve( theDirectoryEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getFileURL</span></p>
<p>returns the URL for a given file</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong></p>
</li>
<li><p><strong>options must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getFileURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFileEntry</span><span class="hljs-params">( theFileEntry )</span> </span>{
            deferred.resolve( theFileEntry.toURL() );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getDirectoryURL</span></p>
<p>Returns a URL for the given directory</p>
<p>Parameters:</p>
<ul>
<li><p><strong>thePath must be a String.</strong></p>
</li>
<li><p><strong>options must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getDirectoryURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( thePath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, thePath || <span class="hljs-string">"."</span>, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectoryEntry</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
            deferred.resolve( theDirectoryEntry.toURL() );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getNativeURL</span></p>
<p>Returns the native URL for an entry by combining the <code>fullPath</code> of the entry
with the <code>nativeURL</code> of the <code>root</code> directory if absolute or of the <code>current</code>
directory if not absolute.</p>
<p>Parameters:</p>
<ul>
<li><strong>theEntry must be a String.</strong><br/>(Path of the file or directory; can also be a File/DirectoryEntry)</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getNativeURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theEntry )</span> </span>{
          <span class="hljs-keyword">var</span> thePath = theEntry;
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> theEntry !== <span class="hljs-string">"string"</span> ) {
            thePath = theEntry.fullPath();
          }
          <span class="hljs-keyword">var</span> isAbsolute = ( thePath.substr( <span class="hljs-number">0</span>, <span class="hljs-number">1</span> ) === <span class="hljs-string">"/"</span> ),
            theRootPath = isAbsolute ? self._root.nativeURL : self.cwd.nativeURL;
          <span class="hljs-keyword">return</span> theRootPath + ( isAbsolute ? <span class="hljs-string">""</span> : <span class="hljs-string">"/"</span> ) + thePath;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getNativeFileURL</span></p>
<p>returns the native file path for a given file</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong></p>
</li>
<li><p><strong>options must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getNativeFileURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFileEntry</span><span class="hljs-params">( theFileEntry )</span> </span>{
            deferred.resolve( theFileEntry.nativeURL );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method getNativeDirectoryURL</span></p>
<p>Returns a URL for the given directory</p>
<p>Parameters:</p>
<ul>
<li><p><strong>thePath must be a String.</strong></p>
</li>
<li><p><strong>options must be a *.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.getNativeDirectoryURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( thePath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, thePath || <span class="hljs-string">"."</span>, options ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectoryEntry</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
            deferred.resolve( theDirectoryEntry.nativeURL );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method changeDirectory</span></p>
<p>Change to an arbitrary directory</p>
<p>Parameters:</p>
<ul>
<li><strong>theNewPath must be a String.</strong><br/>(The path to the directory, relative to cwd)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.changeDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theNewPath )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, theNewPath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectory</span><span class="hljs-params">( theNewDirectory )</span> </span>{
            self.cwd = theNewDirectory;
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">()</span> </span>{
            deferred.resolve( self );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method readFileContents</span></p>
<p>Read an arbitrary file&#39;s contents.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong><br/>(The path to the file, relative to cwd)</p>
</li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the file (such as creating it))</p>
</li>
<li><p><strong>readAsKind must be a String.</strong><br/>(How to read the file -- best to use self.FILETYPE.TEXT, etc.)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.readFileContents = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options, readAsKind )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, options || {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheFileEntry</span><span class="hljs-params">( theFileEntry )</span> </span>{
            <span class="hljs-keyword">return</span> _getFileObject( theFileEntry );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheFileObject</span><span class="hljs-params">( theFileObject )</span> </span>{
            <span class="hljs-keyword">return</span> _readFileContents( theFileObject, readAsKind || <span class="hljs-string">"Text"</span> );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTheFileContents</span><span class="hljs-params">( theFileContents )</span> </span>{
            deferred.resolve( theFileContents );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method readDirectoryContents</span></p>
<p>Read an arbitrary directory&#39;s entries.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryPath must be a String.</strong><br/>(The path to the directory, relative to cwd; &quot;.&quot; if not specified)</p>
</li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the directory (such as creating it))</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.readDirectoryContents = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theDirectoryPath, options )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, theDirectoryPath || <span class="hljs-string">"."</span>, options || {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheDirectoryEntry</span><span class="hljs-params">(
            theDirectoryEntry )</span> </span>{
            <span class="hljs-keyword">return</span> _readDirectoryContents( theDirectoryEntry );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheDirectoryEntries</span><span class="hljs-params">( theEntries )</span> </span>{
            deferred.resolve( theEntries );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method writeFileContents</span></p>
<p>Write data to an arbitrary file</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theFilePath must be a String.</strong><br/>(The file name to write to, relative to cwd)</p>
</li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the file)</p>
</li>
<li><p><strong>theData must be a *.</strong><br/>(The data to write)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.writeFileContents = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath, options, theData )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, options || {
            create: <span class="hljs-literal">true</span>,
            exclusive: <span class="hljs-literal">false</span>
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheFileEntry</span><span class="hljs-params">( theFileEntry )</span> </span>{
            <span class="hljs-keyword">return</span> _createFileWriter( theFileEntry );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheFileWriter</span><span class="hljs-params">( theFileWriter )</span> </span>{
            <span class="hljs-keyword">return</span> _writeFileContents( theFileWriter, theData );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">()</span> </span>{
            deferred.resolve( self );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method createDirectory</span></p>
<p>Creates an arbitrary directory</p>
<p>Parameters:</p>
<ul>
<li><strong>theDirectoryPath must be a String.</strong><br/>(The path, relative to cwd)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.createDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theDirectoryPath )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, theDirectoryPath, {
            create: <span class="hljs-literal">true</span>,
            exclusive: <span class="hljs-literal">false</span>
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectory</span><span class="hljs-params">( theNewDirectory )</span> </span>{
            deferred.resolve( theNewDirectory );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method copyFile</span></p>
<p>Copies a file to a new directory, with an optional new name</p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p>
</li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.copyFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceFilePath, targetDirectoryPath, withNewName )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer(),
            theFileToCopy;
          _getFileEntry( self._cwd, sourceFilePath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFileEntry</span><span class="hljs-params">( aFileToCopy )</span> </span>{
            theFileToCopy = aFileToCopy;
            <span class="hljs-keyword">return</span> _getDirectoryEntry( self._cwd, targetDirectoryPath, {} );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectoryEntry</span><span class="hljs-params">( theTargetDirectory )</span> </span>{
            <span class="hljs-keyword">return</span> _copyFile( theFileToCopy, theTargetDirectory, withNewName );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">( theNewFileEntry )</span> </span>{
            deferred.resolve( theNewFileEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method copyDirectory</span></p>
<p>Copies a directory to a new directory, with an optional new name</p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p>
</li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.copyDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceDirectoryPath, targetDirectoryPath, withNewName )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer(),
            theDirectoryToCopy;
          _getDirectoryEntry( self._cwd, sourceDirectoryPath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotSourceDirectoryEntry</span><span class="hljs-params">(
            sourceDirectoryEntry )</span> </span>{
            theDirectoryToCopy = sourceDirectoryEntry;
            <span class="hljs-keyword">return</span> _getDirectoryEntry( self._cwd, targetDirectoryPath, {} );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTargetDirectoryEntry</span><span class="hljs-params">( theTargetDirectory )</span> </span>{
            <span class="hljs-keyword">return</span> _copyDirectory( theDirectoryToCopy, theTargetDirectory, withNewName );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">( theNewDirectoryEntry )</span> </span>{
            deferred.resolve( theNewDirectoryEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method moveFile</span></p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p>
</li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.moveFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceFilePath, targetDirectoryPath, withNewName )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer(),
            theFileToMove;
          _getFileEntry( self._cwd, sourceFilePath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFileEntry</span><span class="hljs-params">( aFileToMove )</span> </span>{
            theFileToMove = aFileToMove;
            <span class="hljs-keyword">return</span> _getDirectoryEntry( self._cwd, targetDirectoryPath, {} );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotDirectoryEntry</span><span class="hljs-params">( theTargetDirectory )</span> </span>{
            <span class="hljs-keyword">return</span> _moveFile( theFileToMove, theTargetDirectory, withNewName );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">( theNewFileEntry )</span> </span>{
            deferred.resolve( theNewFileEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method moveDirectory</span></p>
<p>Moves a directory to a new directory, with an optional new name</p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p>
</li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.moveDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceDirectoryPath, targetDirectoryPath, withNewName )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer(),
            theDirectoryToMove;
          _getDirectoryEntry( self._cwd, sourceDirectoryPath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotSourceDirectoryEntry</span><span class="hljs-params">(
            sourceDirectoryEntry )</span> </span>{
            theDirectoryToMove = sourceDirectoryEntry;
            <span class="hljs-keyword">return</span> _getDirectoryEntry( self._cwd, targetDirectoryPath, {} );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTargetDirectoryEntry</span><span class="hljs-params">( theTargetDirectory )</span> </span>{
            <span class="hljs-keyword">return</span> _moveDirectory( theDirectoryToMove, theTargetDirectory, withNewName );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">( theNewDirectoryEntry )</span> </span>{
            deferred.resolve( theNewDirectoryEntry );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method renameFile</span></p>
<p>Renames a file to a new name, in the cwd</p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.renameFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceFilePath, withNewName )</span> </span>{
          <span class="hljs-keyword">return</span> self.moveFile( sourceFilePath, <span class="hljs-string">"."</span>, withNewName );
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method renameDirectory</span></p>
<p>Renames a directory to a new name, in the cwd</p>
<p>Parameters:</p>
<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p>
</li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.renameDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( sourceDirectoryPath, withNewName )</span> </span>{
          <span class="hljs-keyword">return</span> self.moveDirectory( sourceDirectoryPath, <span class="hljs-string">"."</span>, withNewName );
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method deleteFile</span></p>
<p>Deletes a file</p>
<p>Parameters:</p>
<ul>
<li><strong>theFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">        self.deleteFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theFilePath )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getFileEntry( self._cwd, theFilePath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheFileToDelete</span><span class="hljs-params">( theFileEntry )</span> </span>{
            <span class="hljs-keyword">return</span> _removeFile( theFileEntry );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">()</span> </span>{
            deferred.resolve( self );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method removeDirectory</span></p>
<p>Removes a directory, possibly recursively</p>
<p>Parameters:</p>
<ul>
<li><p><strong>theDirectoryPath must be a String.</strong><br/>(path to directory, relative to cwd)</p>
</li>
<li><p><strong>recursively must be a Boolean.</strong><br/>(If true, recursive remove)</p>
</li>
</ul>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">        self.removeDirectory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( theDirectoryPath, recursively )</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _getDirectoryEntry( self._cwd, theDirectoryPath, {} ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotTheDirectoryToDelete</span><span class="hljs-params">( theDirectoryEntry )</span> </span>{
            <span class="hljs-keyword">return</span> _removeDirectory( theDirectoryEntry, recursively );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">()</span> </span>{
            deferred.resolve( self );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method _initializeFileSystem</span></p>
<p>Asks the browser for the requested quota, and then requests the file system
and sets the cwd to the root directory.</p>
<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">        self._initializeFileSystem = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">var</span> deferred = Q.defer();
          _requestQuota( self.fileSystemType, self.requestedQuota ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotQuota</span><span class="hljs-params">( theQuota )</span> </span>{
            self._actualQuota = theQuota;
            <span class="hljs-keyword">return</span> _requestFileSystem( self.fileSystemType, self.actualQuota );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotFS</span><span class="hljs-params">( theFS )</span> </span>{
            self._fileSystem = theFS;
            <span class="hljs-comment">//self._cwd = theFS.root;</span>
            <span class="hljs-keyword">return</span> _getDirectoryEntry( theFS.root, <span class="hljs-string">""</span>, {} );
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gotRootDirectory</span><span class="hljs-params">( theRootDirectory )</span> </span>{
            self._root = theRootDirectory;
            self._cwd = theRootDirectory;
          } ).then( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDone</span><span class="hljs-params">()</span> </span>{
            deferred.resolve( self );
          } ).
          <span class="hljs-keyword">catch</span>( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( anError )</span> </span>{
            deferred.reject( anError );
          } ).done();
          <span class="hljs-keyword">return</span> deferred.promise;
        };
        <span class="hljs-keyword">if</span> ( self.overrideSuper ) {
          self.overrideSuper( self.class, <span class="hljs-string">"init"</span>, self.init );
        }</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method init</span></p>
<p>Initializes the file manager with the requested file system type (self.PERSISTENT or self.TEMPORARY)
and requested quota size. Both must be specified.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>fileSystemType must be a FileSystem.</strong></p>
</li>
<li><p><strong>requestedQuota must be a Number.</strong></p>
</li>
</ul></div></div><div class="code"><div class="wrapper">        self.init = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( fileSystemType, requestedQuota )</span> </span>{
          <span class="hljs-keyword">if</span> ( self.super ) {
            self.super( _className, <span class="hljs-string">"init"</span> );
          }
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> fileSystemType === <span class="hljs-string">"undefined"</span> ) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"No file system type specified; specify PERSISTENT or TEMPORARY."</span> );
          }
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> requestedQuota === <span class="hljs-string">"undefined"</span> ) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"No quota requested. If you don't know, specify ZERO."</span> );
          }
          self._requestedQuota = requestedQuota;
          self._fileSystemType = fileSystemType;
          <span class="hljs-keyword">return</span> self._initializeFileSystem(); <span class="hljs-comment">// this returns a promise, so we can .then after.</span>
        };</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Method initWithOptions</span></p>
<p>Initializes the file manager with the requested file system type (self.PERSISTENT or self.TEMPORARY)
and requested quota size. Both must be specified.</p>
<p>Parameters:</p>
<ul>
<li><strong>options must be a *.</strong></li>
</ul></div></div><div class="code"><div class="wrapper">        self.initWithOptions = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( options )</span> </span>{
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">"undefined"</span> ) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"No options specified. Need type and quota."</span> );
          }
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> options.fileSystemType === <span class="hljs-string">"undefined"</span> ) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"No file system type specified; specify PERSISTENT or TEMPORARY."</span> );
          }
          <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> options.requestedQuota === <span class="hljs-string">"undefined"</span> ) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">"No quota requested. If you don't know, specify ZERO."</span> );
          }
          <span class="hljs-keyword">return</span> self.init( options.fileSystemType, options.requestedQuota );
        };
        <span class="hljs-keyword">return</span> self;
      };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>meta information</p></div></div><div class="code"><div class="wrapper">    FileManager.meta = {
      version: <span class="hljs-string">"00.04.450"</span>,
      <span class="hljs-keyword">class</span>: _className,
      autoInitializable: <span class="hljs-literal">false</span>,
      categorizable: <span class="hljs-literal">false</span>
    };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>assign to <code>window</code> if stand-alone</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> ( globalContext ) {
      globalContext.FileManager = FileManager;
    }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>return factory</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">return</span> FileManager;
  } )( Q, BaseObject, ( <span class="hljs-keyword">typeof</span> IN_YASMF !== <span class="hljs-string">"undefined"</span> ) ? <span class="hljs-literal">undefined</span> : <span class="hljs-built_in">window</span> );
} );</div></div></div></div></body></html>