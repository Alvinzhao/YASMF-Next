<!DOCTYPE html><html lang="en"><head><title>util/h</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="util/h"><meta name="groc-project-path" content="lib/yasmf/util/h.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/yasmf/util/h.js</div></div><div id="document"><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Module h.js author Kerri Shotts and version 0.1</p>

<pre><code>Copyright (c) 2014 Kerri Shotts, photoKandy Studios LLC
Permission is hereby granted, free of charge, to any person obtaining a copy of this
software and associated documentation files (the "Software"), to deal in the Software
without restriction, including without limitation the rights to use, copy, modify,
merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to the following
conditions:
The above copyright notice and this permission notice shall be included in all copies
or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
</code></pre>

<p></span></p>

<p>h - simple DOM demplating</p></div></div><div class="code"><div class="wrapper"><span class="cm">/*jshint</span>
<span class="cm">     asi:true,</span>
<span class="cm">     bitwise:true,</span>
<span class="cm">     browser:true,</span>
<span class="cm">     camelcase:true,</span>
<span class="cm">     curly:true,</span>
<span class="cm">     eqeqeq:false,</span>
<span class="cm">     forin:true,</span>
<span class="cm">     noarg:true,</span>
<span class="cm">     noempty:true,</span>
<span class="cm">     plusplus:false,</span>
<span class="cm">     smarttabs:true,</span>
<span class="cm">     sub:true,</span>
<span class="cm">     trailing:false,</span>
<span class="cm">     undef:true,</span>
<span class="cm">     white:false,</span>
<span class="cm">     onevar:false</span>
<span class="cm">*/</span>
<span class="cm">/*global define, Node, document*/</span>
<span class="nx">define</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;yasmf/util/object&quot;</span> <span class="p">],</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">BaseObject</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>internal private method to handle parsing children
and attaching them to their parents</p>

<p>If the child is a NODE, it is attached directly to the parent as a child
If the child is a FUNCTION, the RESULTS are re-parsed, ultimately to be attached to the parent
  as children
If the child is an ARRAY, each element within the array is re-parsed, ultimately to be attached
  to the parent as children</p>

<p>Parameters:</p>

<ul>
<li><p><strong>child can be an Array, a Function, or a Node.</strong><br/>(child to handle and attach)</p></li>
<li><p><strong>parent must be a Node.</strong><br/>(parent)</p></li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">handleChild</span><span class="p">(</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">parent</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">child</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">handleChild</span><span class="p">(</span> <span class="nx">child</span><span class="p">[</span> <span class="nx">i</span> <span class="p">],</span> <span class="nx">parent</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">Node</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">child</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">child</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">handleChild</span><span class="p">(</span> <span class="nx">child</span><span class="p">(),</span> <span class="nx">parent</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>parses an incoming tag into its tag name, id, and class constituents
A tag is of the form "tagName.class#id" or "tagName#id.class". The id and class
are optional.</p>

<p>Parameters:</p>

<ul>
<li><strong>tag must be a string.</strong><br/>(tag to parse)</li>
</ul>

<p><strong>Returns a *</strong><br/>(Object of the form { tag: tagName, id: id, class: class })</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">parseTag</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tagParts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">tag</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nx">id</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
        <span class="kr">class</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">},</span>
      <span class="nx">hashPos</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s2">&quot;#&quot;</span> <span class="p">),</span>
      <span class="nx">dotPos</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s2">&quot;.&quot;</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">hashPos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">dotPos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">hashPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">dotPos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">hashPos</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">hashPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span>
      <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">dotPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">hashPos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">dotPos</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="kr">class</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">dotPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span>
      <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">dotPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">hashPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">hashPos</span> <span class="o">&lt;</span> <span class="nx">dotPos</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">hashPos</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">hashPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span> <span class="nx">dotPos</span> <span class="o">-</span> <span class="nx">hashPos</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="kr">class</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">dotPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span>
      <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">dotPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">hashPos</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">dotPos</span> <span class="o">&lt;</span> <span class="nx">hashPos</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">dotPos</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="kr">class</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">dotPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span> <span class="nx">hashPos</span> <span class="o">-</span> <span class="nx">dotPos</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>
      <span class="nx">tagParts</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="nx">hashPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">length</span> <span class="p">);</span>
      <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">tagParts</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>h templating engine
  short for HTML</p>

<p>Generates a DOM tree (or just a single node) based on a series of method calls
into h. h has one root method (el) that creates all DOM elements, but also has
helper methods for each HTML tag. This means that a UL can be created simply by
calling h.ul.</p>

<p>Technically there's no such thing as a template using this library, but functions
encapsulating a series of h calls function as an equivalent if properly decoupled
from their surrounds.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Returns a DOM tree containing the requested element and any further child
elements (as extra parameters)</p>

<p>Parameters:</p>

<ul>
<li><p><strong>tag must be a string.</strong><br/>(tag of the form "tagName.class#id" or "tagName#id.class")</p></li>
<li><p><strong>tagOptions must be a *.</strong><br/>(options for the tag)</p>

<ul><li><strong>... can be an Array, a Function, or a String.</strong><br/>(children that should be attached)</li></ul></li>
</ul>

<p><strong>Returns a Node</strong><br/>(DOM tree tagOptions should be an object consisting of the following optional segments: <code>{ attrs: {...} attributes to add to the element styles: {...} style attributes to add to the element on: {...} event handlers to attach to the element bind: { object:, keyPath: } data binding store: { object:, keyPath: } store element to object.keyPath }</code>)</p></div></div><div class="code"><div class="wrapper">      <span class="nx">el</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span><span class="p">,</span>
          <span class="nx">options</span><span class="p">,</span>
          <span class="nx">content</span><span class="p">,</span>
          <span class="nx">tagParts</span> <span class="o">=</span> <span class="nx">parseTag</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">);</span> <span class="c1">// parse tag; it should be of the form tag[#id][.class]</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>create the element; if @DF is used, a document fragment is used instead</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="o">!==</span> <span class="s2">&quot;@DF&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="nx">tagParts</span><span class="p">.</span><span class="nx">tag</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>attach the class and id from the tag name, if available</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="nx">tagParts</span><span class="p">.</span><span class="kr">class</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">tagParts</span><span class="p">.</span><span class="kr">class</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">tagParts</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nx">tagParts</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>get the arguments as an array, ignoring the first parameter</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>determine what we've passed in the second/third parameter
if it is an object (but not a node or array), it's a list of
options to attach to the element. If it is a string, it's text
content that should be added using .textContent.
note: we could parse the entire argument list, but that would
a bit absurd.</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>could be a DOM node, an array, or tag options</p></div></div><div class="code"><div class="wrapper">              <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="k">instanceof</span> <span class="nx">Node</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">options</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">args</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this is text content</p></div></div><div class="code"><div class="wrapper">              <span class="nx">content</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>copy over any attributes and styles in options.attrs and options.style</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>add attributes</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">attrs</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">attrs</span> <span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="nx">attr</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">attrs</span><span class="p">[</span> <span class="nx">attr</span> <span class="p">]</span> <span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>add styles</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">styles</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">style</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">styles</span> <span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="nx">style</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span> <span class="nx">style</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">styles</span><span class="p">[</span> <span class="nx">style</span> <span class="p">];</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>add event handlers; handler property is expected to be a valid DOM
event, i.e. { "change": function... } or { change: function... }
if the handler is an object, it must be of the form
  { handler: function ...,
    capture: true/false }</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">evt</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span> <span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span> <span class="nx">evt</span> <span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span> <span class="p">)</span> <span class="p">{</span>
                  <span class="nx">e</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span> <span class="nx">evt</span> <span class="p">].</span><span class="nx">bind</span><span class="p">(</span> <span class="nx">e</span> <span class="p">),</span> <span class="kc">false</span> <span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="nx">e</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span> <span class="nx">evt</span> <span class="p">].</span><span class="nx">handler</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="nx">e</span> <span class="p">),</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span> <span class="nx">evt</span> <span class="p">].</span><span class="nx">capture</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                    <span class="nx">options</span><span class="p">.</span><span class="nx">on</span><span class="p">[</span> <span class="nx">evt</span> <span class="p">].</span><span class="nx">capture</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">);</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Data binding only occurs if using YASMF's BaseObject for now (built-in pubsub)
along with observable properties
the binding object is of the form { object: objectRef, keyPath: "keyPath" }</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">BaseObject</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">object</span> <span class="k">instanceof</span> <span class="nx">BaseObject</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>we have an object that has observable properties</p></div></div><div class="code"><div class="wrapper">                <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">dataBindOn</span><span class="p">(</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">keyPath</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>get the current value so it can be displayed</p></div></div><div class="code"><div class="wrapper">                <span class="nx">content</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">object</span><span class="p">[</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">keyPath</span> <span class="p">];</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>allow elements to be stored into a context
store must be an object of the form {object:objectRef, keyPath: "keyPath" }</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">store</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">object</span><span class="p">[</span> <span class="nx">options</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">keyPath</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if we have content, go ahead and add it
if we're an element that has a value, we attach it to the value
property instead of textContent. If textContent is not available
we use innerText; if that's not available, we complain and do
nothing. Falling back to innerHTML isn't an option, as that's what
we are explicitly trying to avoid.</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">content</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">content</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">e</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;WARNING! This browser doesn&#39;t support textContent or innerText.&quot;</span> <span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Handle children; handleChild appends each one to the parent</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="c1">//console.log(i);</span>
          <span class="nx">child</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span> <span class="nx">i</span> <span class="p">];</span>
          <span class="nx">handleChild</span><span class="p">(</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">e</span> <span class="p">);</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>return the element (and associated tree)</p></div></div><div class="code"><div class="wrapper">        <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>create bindings for each HTML element (from: https://developer.mozilla.org/en-US/docs/Web/HTML/Element)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">els</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;abbr&quot;</span><span class="p">,</span> <span class="s2">&quot;acronym&quot;</span><span class="p">,</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;applet&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;article&quot;</span><span class="p">,</span> <span class="s2">&quot;aside&quot;</span><span class="p">,</span> <span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;basefont&quot;</span><span class="p">,</span> <span class="s2">&quot;bdi&quot;</span><span class="p">,</span>
      <span class="s2">&quot;bdo&quot;</span><span class="p">,</span> <span class="s2">&quot;bgsound&quot;</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">,</span> <span class="s2">&quot;blink&quot;</span><span class="p">,</span> <span class="s2">&quot;blockquote&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="s2">&quot;br&quot;</span><span class="p">,</span> <span class="s2">&quot;button&quot;</span><span class="p">,</span> <span class="s2">&quot;canvas&quot;</span><span class="p">,</span> <span class="s2">&quot;caption&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;cite&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span>
      <span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="s2">&quot;colgroup&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;datalist&quot;</span><span class="p">,</span> <span class="s2">&quot;dd&quot;</span><span class="p">,</span> <span class="s2">&quot;decorator&quot;</span><span class="p">,</span> <span class="s2">&quot;del&quot;</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="s2">&quot;dfn&quot;</span><span class="p">,</span> <span class="s2">&quot;dialog&quot;</span><span class="p">,</span> <span class="s2">&quot;dir&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="s2">&quot;dl&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dt&quot;</span><span class="p">,</span> <span class="s2">&quot;element&quot;</span><span class="p">,</span> <span class="s2">&quot;em&quot;</span><span class="p">,</span> <span class="s2">&quot;embed&quot;</span><span class="p">,</span> <span class="s2">&quot;fieldset&quot;</span><span class="p">,</span> <span class="s2">&quot;figcaption&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">,</span> <span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;footer&quot;</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span><span class="p">,</span> <span class="s2">&quot;frameset&quot;</span><span class="p">,</span> <span class="s2">&quot;h1&quot;</span><span class="p">,</span> <span class="s2">&quot;h2&quot;</span><span class="p">,</span> <span class="s2">&quot;h3&quot;</span><span class="p">,</span>
      <span class="s2">&quot;h4&quot;</span><span class="p">,</span> <span class="s2">&quot;h5&quot;</span><span class="p">,</span> <span class="s2">&quot;h6&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;hgroup&quot;</span><span class="p">,</span> <span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;iframe&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ins&quot;</span><span class="p">,</span> <span class="s2">&quot;isindex&quot;</span><span class="p">,</span> <span class="s2">&quot;kbd&quot;</span><span class="p">,</span>
      <span class="s2">&quot;keygen&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;legend&quot;</span><span class="p">,</span> <span class="s2">&quot;li&quot;</span><span class="p">,</span> <span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="s2">&quot;listing&quot;</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="s2">&quot;mark&quot;</span><span class="p">,</span> <span class="s2">&quot;marquee&quot;</span><span class="p">,</span> <span class="s2">&quot;menu&quot;</span><span class="p">,</span> <span class="s2">&quot;menuitem&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;meter&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nav&quot;</span><span class="p">,</span> <span class="s2">&quot;nobr&quot;</span><span class="p">,</span> <span class="s2">&quot;noframes&quot;</span><span class="p">,</span> <span class="s2">&quot;noscript&quot;</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;ol&quot;</span><span class="p">,</span> <span class="s2">&quot;optgroup&quot;</span><span class="p">,</span> <span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">,</span> <span class="s2">&quot;picture&quot;</span><span class="p">,</span> <span class="s2">&quot;plaintext&quot;</span><span class="p">,</span>
      <span class="s2">&quot;pre&quot;</span><span class="p">,</span> <span class="s2">&quot;progress&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;rp&quot;</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;samp&quot;</span><span class="p">,</span> <span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span>
      <span class="s2">&quot;spacer&quot;</span><span class="p">,</span> <span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="s2">&quot;strike&quot;</span><span class="p">,</span> <span class="s2">&quot;strong&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">,</span> <span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="s2">&quot;sup&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="s2">&quot;tbody&quot;</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="s2">&quot;textarea&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tfoot&quot;</span><span class="p">,</span> <span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="s2">&quot;thead&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="s2">&quot;track&quot;</span><span class="p">,</span> <span class="s2">&quot;tt&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;ul&quot;</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="s2">&quot;wbr&quot;</span><span class="p">,</span> <span class="s2">&quot;xmp&quot;</span>
    <span class="p">];</span>
  <span class="nx">els</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">el</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">h</span><span class="p">[</span> <span class="nx">el</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">el</span> <span class="p">);</span>
  <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>bind document fragment too</p></div></div><div class="code"><div class="wrapper">  <span class="nx">h</span><span class="p">.</span><span class="nx">DF</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span> <span class="nx">h</span><span class="p">,</span> <span class="s2">&quot;@DF&quot;</span> <span class="p">);</span>
  <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
<span class="p">}</span> <span class="p">);</span></div></div></div></div></body></html>