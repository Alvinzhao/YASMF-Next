<!DOCTYPE html><html lang="en"><head><title>util/fileManager</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="util/fileManager"><meta name="groc-project-path" content="lib/yasmf/util/fileManager.js"><meta name="groc-github-url" content="https://github.com/photokandyStudios/YASMF-Next"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/photokandyStudios/YASMF-Next/blob/master/lib/yasmf/util/fileManager.js">lib/yasmf/util/fileManager.js</a></div></div><div id="document"><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'>Module core.js author Kerri Shotts and version 0.4</p>

<p>Copyright (c) 2013 Kerri Shotts, photoKandy Studios LLC
Permission is hereby granted, free of charge, to any person obtaining a copy of this
software and associated documentation files (the "Software"), to deal in the Software
without restriction, including without limitation the rights to use, copy, modify,
merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to the following
conditions:
The above copyright notice and this permission notice shall be included in all copies
or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.</span></p>

<p>FileManager implements methods that interact with the HTML5 API</p>

<p>core.js</p></div></div><div class="code"><div class="wrapper"><span class="cm">/*jshint</span>
<span class="cm">         asi:true,</span>
<span class="cm">         bitwise:true,</span>
<span class="cm">         browser:true,</span>
<span class="cm">         camelcase:true,</span>
<span class="cm">         curly:true,</span>
<span class="cm">         eqeqeq:false,</span>
<span class="cm">         forin:true,</span>
<span class="cm">         noarg:true,</span>
<span class="cm">         noempty:true,</span>
<span class="cm">         plusplus:false,</span>
<span class="cm">         smarttabs:true,</span>
<span class="cm">         sub:true,</span>
<span class="cm">         trailing:false,</span>
<span class="cm">         undef:true,</span>
<span class="cm">         white:false,</span>
<span class="cm">         onevar:false,</span>
<span class="cm">         loopfunc:true</span>
<span class="cm"> */</span>
<span class="cm">/*global define, Q, LocalFileSystem, console*/</span>
<span class="nx">define</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;yasmf/util/object&quot;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">Q</span><span class="p">,</span> <span class="nx">BaseObject</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} Promise</span></p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">DEBUG</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Requests a quota from the file system</p>

<p>Parameters:</p>

<ul>
<li><p><strong>fileSystemType must be a *.</strong><br/>(PERSISTENT or TEMPORARY)</p></li>
<li><p><strong>requestedDataSize must be a Number.</strong><br/>(The quota we're asking for)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_requestQuota</span><span class="p">(</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestQuota: &quot;</span><span class="p">,</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>make sure we can actually ask for a quota
Chrome currently has navigator.webkitPersistentStorage and navigator.webkitTemporaryStorage
No idea what this is going to be unprefixed...</p></div></div><div class="code"><div class="wrapper">    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">PERSISTENT</span> <span class="o">=</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">LocalFileSystem</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">LocalFileSystem</span><span class="p">.</span><span class="nx">PERSISTENT</span> <span class="o">:</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">PERSISTENT</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">storageInfo</span> <span class="o">=</span> <span class="nx">fileSystemType</span> <span class="o">==</span> <span class="nx">PERSISTENT</span> <span class="o">?</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">webkitPersistentStorage</span> <span class="o">:</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">webkitTemporaryStorage</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">storageInfo</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>now make sure we can request a quota</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span> <span class="nx">storageInfo</span><span class="p">.</span><span class="nx">requestQuota</span> <span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>request the quota</p></div></div><div class="code"><div class="wrapper">          <span class="nx">storageInfo</span><span class="p">.</span><span class="nx">requestQuota</span><span class="p">(</span> <span class="nx">requestedDataSize</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">grantedBytes</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestQuota: quota granted: &quot;</span><span class="p">,</span> <span class="nx">fileSystemType</span><span class="p">,</span>
                <span class="nx">grantedBytes</span>
              <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">grantedBytes</span> <span class="p">);</span>
          <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestQuota: quota rejected: &quot;</span><span class="p">,</span> <span class="nx">fileSystemType</span><span class="p">,</span>
                <span class="nx">requestedDataSize</span><span class="p">,</span> <span class="nx">anError</span>
              <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
          <span class="p">}</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>not everything supports asking for a quota -- like Cordova
instead, let's assume we get permission</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestQuota: couldn&#39;t request quota -- no requestQuota: &quot;</span><span class="p">,</span>
              <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
          <span class="p">}</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">requestedDataSize</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestQuota: couldn&#39;t request quota -- no storageInfo: &quot;</span><span class="p">,</span>
            <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span>
          <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">requestedDataSize</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Request a file system with the requested size (obtained first by getting a quota)</p>

<p>Parameters:</p>

<ul>
<li><p><strong>fileSystemType must be a *.</strong><br/>(TEMPORARY or PERSISTENT)</p></li>
<li><p><strong>requestedDataSize must be a Number.</strong><br/>(The quota)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_requestFileSystem</span><span class="p">(</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestFileSystem: &quot;</span><span class="p">,</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span>
        <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">requestFileSystem</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitRequestFileSystem</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestFileSystem</span><span class="p">;</span>
      <span class="nx">requestFileSystem</span><span class="p">(</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedDataSize</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span>
        <span class="nx">theFileSystem</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestFileSystem: got a file system&quot;</span><span class="p">,</span> <span class="nx">theFileSystem</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span>
            <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileSystem</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_requestFileSystem: couldn&#39;t get a file system&quot;</span><span class="p">,</span>
            <span class="nx">fileSystemType</span>
          <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Resolves theURI to a fileEntry or directoryEntry, if possible.</p>

<p>Parameters:</p>

<ul>
<li><strong>theURL must be a String.</strong><br/>(the path, should start with file://, but if it doesn't we'll add it.)</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_resolveLocalFileSystemURL</span><span class="p">(</span> <span class="nx">theURL</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_resolveLocalFileSystemURL: &quot;</span><span class="p">,</span> <span class="nx">theURL</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">theURL</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span> <span class="s2">&quot;:&quot;</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">protocol</span><span class="p">,</span> <span class="nx">path</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;The URI is not well-formed; missing protocol: &quot;</span> <span class="o">+</span> <span class="nx">theURL</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">protocol</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span><span class="p">;</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">protocol</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span> <span class="mi">1</span> <span class="p">];</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">pathComponents</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span> <span class="s2">&quot;/&quot;</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">newPathComponents</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">pathComponents</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">part</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">part</span> <span class="o">=</span> <span class="nx">part</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">part</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// remove /private if it is the first item in the new array, for iOS sake</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span> <span class="p">(</span> <span class="nx">part</span> <span class="o">===</span> <span class="s2">&quot;private&quot;</span> <span class="o">||</span> <span class="nx">part</span> <span class="o">===</span> <span class="s2">&quot;localhost&quot;</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">newPathComponents</span>
            <span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">newPathComponents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">part</span> <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">theNewURI</span> <span class="o">=</span> <span class="nx">newPathComponents</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot;/&quot;</span> <span class="p">);</span>
      <span class="nx">theNewURI</span> <span class="o">=</span> <span class="nx">protocol</span> <span class="o">+</span> <span class="s2">&quot;:///&quot;</span> <span class="o">+</span> <span class="nx">theNewURI</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">resolveLocalFileSystemURL</span><span class="p">(</span> <span class="nx">theNewURI</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theEntry</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} DirectoryEntry
Returns a directory entry based on the path from the parent using
the specified options ( or {} )</span></p>

<p>Parameters:</p>

<ul>
<li><p><strong>parent must be a DirectoryEntry.</strong><br/>(The parent that path is relative from (or absolute))</p></li>
<li><p><strong>path must be a String.</strong><br/>(The relative or absolute path)</p></li>
<li><p><strong>options must be an Object.</strong><br/>(The options (that is, create the directory if it doesn't exist, etc.))</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_getDirectoryEntry:&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">path</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">path</span> <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">getDirectory</span><span class="p">(</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{},</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">);</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Returns a file entry based on the path from the parent using
the specified options ( or {} )</p>

<p>Parameters:</p>

<ul>
<li><p><strong>parent must be a DirectoryEntry.</strong><br/>(The parent that path is relative from (or absolute))</p></li>
<li><p><strong>path must be a String.</strong><br/>(The relative or absolute path)</p></li>
<li><p><strong>options must be an Object.</strong><br/>(The options (that is, create the file if it doesn't exist, etc.))</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_getFileEntry:&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">path</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">path</span> <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{},</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">);</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} FileEntry
Returns a file object based on the file entry.</span></p>

<p>Parameters:</p>

<ul>
<li><strong>fileEntry must be a FileEntry.</strong><br/>(The file Entry)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_getFileObject</span><span class="p">(</span> <span class="nx">fileEntry</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_getFileObject:&quot;</span><span class="p">,</span> <span class="nx">fileEntry</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">fileEntry</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">theFile</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFile</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Reads the file contents from a file object. readAsKind indicates how
to read the file ("Text", "DataURL", "BinaryString", "ArrayBuffer").</p>

<p>Parameters:</p>

<ul>
<li><p><strong>fileObject must be a File.</strong><br/>(File to read)</p></li>
<li><p><strong>readAsKind must be a String.</strong><br/>("Text", "DataURL", "BinaryString", "ArrayBuffer")</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_readFileContents</span><span class="p">(</span> <span class="nx">fileObject</span><span class="p">,</span> <span class="nx">readAsKind</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_readFileContents:&quot;</span><span class="p">,</span> <span class="nx">fileObject</span><span class="p">,</span> <span class="nx">readAsKind</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fileReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
      <span class="nx">fileReader</span><span class="p">.</span><span class="nx">onloadend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span> <span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">fileReader</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">fileReader</span><span class="p">[</span> <span class="s2">&quot;readAs&quot;</span> <span class="o">+</span> <span class="nx">readAsKind</span> <span class="p">](</span> <span class="nx">fileObject</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Creates a file writer for the file entry</p>

<p>Parameters:</p>

<ul>
<li><strong>fileEntry must be a FileEntry.</strong><br/>(The file entry to write to)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(the Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_createFileWriter</span><span class="p">(</span> <span class="nx">fileEntry</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_createFileWriter:&quot;</span><span class="p">,</span> <span class="nx">fileEntry</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fileWriter</span> <span class="o">=</span> <span class="nx">fileEntry</span><span class="p">.</span><span class="nx">createWriter</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">theFileWriter</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileWriter</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} FileWriter
Write the contents to the fileWriter</span></p>

<p>Parameters:</p>

<ul>
<li><p><strong>fileWriter must be a FileWriter.</strong><br/>(Obtained from _createFileWriter)</p></li>
<li><p><strong>contents must be a *.</strong><br/>(The contents to write)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(the Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_writeFileContents</span><span class="p">(</span> <span class="nx">fileWriter</span><span class="p">,</span> <span class="nx">contents</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_writeFileContents:&quot;</span><span class="p">,</span> <span class="nx">fileWriter</span><span class="p">,</span> <span class="nx">contents</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">onwrite</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">onwrite</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">e</span> <span class="p">);</span>
        <span class="p">};</span>
        <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="nx">contents</span> <span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">onError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">truncate</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span> <span class="c1">// clear out the contents, first</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Copy the file to the specified parent directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to copy)</p></li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to copy the file to)</p></li>
<li><p><strong>theNewName must be a String.</strong><br/>(The new name of the file ( or undefined simply to copy ))</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_copyFile</span><span class="p">(</span> <span class="nx">theFileEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_copyFile:&quot;</span><span class="p">,</span> <span class="nx">theFileEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span>
        <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">theFileEntry</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span>
        <span class="nx">theNewFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Move the file to the specified parent directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to move or rename)</p></li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to move the file to (or the same as the file in order to rename))</p></li>
<li><p><strong>theNewName must be a String.</strong><br/>(The new name of the file ( or undefined simply to move ))</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_moveFile</span><span class="p">(</span> <span class="nx">theFileEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_moveFile:&quot;</span><span class="p">,</span> <span class="nx">theFileEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span>
        <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">theFileEntry</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span>
        <span class="nx">theNewFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Remove the file from the file system</p>

<p>Parameters:</p>

<ul>
<li><strong>theFileEntry must be a FileEntry.</strong><br/>(The file to remove)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_removeFile</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_removeFile:&quot;</span><span class="p">,</span> <span class="nx">theFileEntry</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">theFileEntry</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Copies a directory to the specified directory, with an optional new name. The directory
is copied recursively.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to copy)</p></li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to copy the first directory to)</p></li>
<li><p><strong>theNewName must be a String.</strong><br/>(The optional new name for the directory)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(A promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_copyDirectory</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_copyDirectory:&quot;</span><span class="p">,</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span>
        <span class="nx">theNewName</span>
      <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span>
        <span class="nx">theNewDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Moves a directory to the specified directory, with an optional new name. The directory
is moved recursively.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to move)</p></li>
<li><p><strong>theParentDirectoryEntry must be a DirectoryEntry.</strong><br/>(The parent directory to move the first directory to)</p></li>
<li><p><strong>theNewName must be a String.</strong><br/>(The optional new name for the directory)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(A promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_moveDirectory</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_moveDirectory:&quot;</span><span class="p">,</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span>
        <span class="nx">theNewName</span>
      <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span> <span class="nx">theParentDirectoryEntry</span><span class="p">,</span> <span class="nx">theNewName</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span>
        <span class="nx">theNewDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">);</span>
      <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Removes a directory from the file system. If recursively is true, the directory is removed
recursively.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to remove)</p></li>
<li><p><strong>recursively must be a Boolean.</strong><br/>(If true, remove recursively)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_removeDirectory</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">recursively</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_removeDirectory:&quot;</span><span class="p">,</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="s2">&quot;recursively&quot;</span><span class="p">,</span> <span class="nx">recursively</span> <span class="p">]</span>
        <span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">recursively</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">removeRecursively</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Reads the contents of a directory</p>

<p>Parameters:</p>

<ul>
<li><strong>theDirectoryEntry must be a DirectoryEntry.</strong><br/>(The directory to list)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_readDirectoryContents</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">DEBUG</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="p">[</span> <span class="s2">&quot;_readDirectoryContents:&quot;</span><span class="p">,</span> <span class="nx">theDirectoryEntry</span> <span class="p">].</span><span class="nx">join</span><span class="p">(</span> <span class="s2">&quot; &quot;</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">directoryReader</span> <span class="o">=</span> <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">createReader</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="kd">function</span> <span class="nx">readEntries</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">directoryReader</span><span class="p">.</span><span class="nx">readEntries</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">success</span><span class="p">(</span> <span class="nx">theEntries</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">theEntries</span><span class="p">.</span><span class="nx">length</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">entries</span> <span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">entries</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">theEntries</span> <span class="o">||</span> <span class="p">[],</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">);</span>
            <span class="nx">readEntries</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="kd">function</span> <span class="nx">failure</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">readEntries</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">_className</span> <span class="o">=</span> <span class="s2">&quot;UTIL.FileManager&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">FileManager</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasBaseObject</span> <span class="o">=</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">BaseObject</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">hasBaseObject</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaseObject</span><span class="p">();</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">subclass</span><span class="p">(</span> <span class="nx">_className</span> <span class="p">);</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">registerNotification</span><span class="p">(</span> <span class="s2">&quot;changedCurrentWorkingDirectory&quot;</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>get the persistent and temporary filesystem constants</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">PERSISTENT</span> <span class="o">=</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">LocalFileSystem</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">LocalFileSystem</span><span class="p">.</span><span class="nx">PERSISTENT</span> <span class="o">:</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">PERSISTENT</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">TEMPORARY</span> <span class="o">=</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">LocalFileSystem</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="o">?</span> <span class="nx">LocalFileSystem</span><span class="p">.</span><span class="nx">TEMPORARY</span> <span class="o">:</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">TEMPORARY</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">FILETYPE</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">TEXT</span><span class="o">:</span> <span class="s2">&quot;Text&quot;</span><span class="p">,</span>
      <span class="nx">DATA_URL</span><span class="o">:</span> <span class="s2">&quot;DataURL&quot;</span><span class="p">,</span>
      <span class="nx">BINARY</span><span class="o">:</span> <span class="s2">&quot;BinaryString&quot;</span><span class="p">,</span>
      <span class="nx">ARRAY_BUFFER</span><span class="o">:</span> <span class="s2">&quot;ArrayBuffer&quot;</span>
    <span class="p">};</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getGlobalDebug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">DEBUG</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">setGlobalDebug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">debug</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">DEBUG</span> <span class="o">=</span> <span class="nx">debug</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;globalDebug&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getGlobalDebug</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setGlobalDebug</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>the fileSystemType can either be self.PERSISTENT or self.TEMPORARY, and is only
set during an INIT operation. It cannot be set at any other time.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystemType</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// can only be changed during INIT</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getFileSystemType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystemType</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;fileSystemType&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFileSystemType</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The requested quota -- stored for future reference, since we ask for it
specifically during an INIT operation. It cannot be changed.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_requestedQuota</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// can only be changed during INIT</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getRequestedQuota</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_requestedQuota</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;requestedQuota&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getRequestedQuota</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> of type <em>Number</em></span></p>

<p>The actual quota obtained from the system. It cannot be changed, and is
only obtained during an INIT.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_actualQuota</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getActualQuota</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_actualQuota</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;actualQuota&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getActualQuota</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> typedef {{}} FileSystem
The current filesystem -- either the temporary or persistent one; it can't be changed and of type <em>FileSystem</em></span></p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystem</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getFileSystem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystem</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;fileSystem&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFileSystem</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> of type <em>[type]</em></span></p>

<p>Current Working Directory Entry</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_root</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getCurrentWorkingDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">setCurrentWorkingDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theCWD</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span> <span class="o">=</span> <span class="nx">theCWD</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">hasBaseObject</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span> <span class="s2">&quot;changedCurrentWorkingDirectory&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;cwd&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getCurrentWorkingDirectory</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setCurrentWorkingDirectory</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span> <span class="nx">self</span><span class="p">,</span> <span class="s2">&quot;currentWorkingDirectory&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getCurrentWorkingDirectory</span><span class="p">,</span>
      <span class="nx">set</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">setCurrentWorkingDirectory</span><span class="p">,</span>
      <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="p">);</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> of type <em>Array</em></span></p>

<p>Current Working Directory stack</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_cwds</span> <span class="o">=</span> <span class="p">[];</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Push the current working directory on to the stack</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">pushCurrentWorkingDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_cwds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span> <span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pop the topmost directory on the stack and change to it</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">popCurrentWorkingDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">setCurrentWorkingDirectory</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwds</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">resolveLocalFileSystemURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theURI</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_resolveLocalFileSystemURL</span><span class="p">(</span> <span class="nx">theURI</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotEntry</span><span class="p">(</span> <span class="nx">theEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns the file entry for the given path (useful for
getting the full path of a file)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getFileEntry</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFileEntry</span><span class="p">(</span>
        <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns the file object for a given file (useful for getting
the size of a file)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getFileEntry</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="nx">_getFileObject</span> <span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns the directory entry for a given path</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getDirectoryEntry</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectoryEntry</span><span class="p">(</span>
        <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>returns the URL for a given file</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getFileURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFileEntry</span><span class="p">(</span>
        <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileEntry</span><span class="p">.</span><span class="nx">toURL</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns a URL for the given directory</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getDirectoryURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">thePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">thePath</span> <span class="o">||</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectoryEntry</span><span class="p">(</span>
        <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">toURL</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">getNativeURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theEntry</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">thePath</span> <span class="o">=</span> <span class="nx">theEntry</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">theEntry</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">thePath</span> <span class="o">=</span> <span class="nx">theEntry</span><span class="p">.</span><span class="nx">fullPath</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">isAbsolute</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">thePath</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">theRootPath</span> <span class="o">=</span> <span class="nx">isAbsolute</span> <span class="o">?</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_root</span><span class="p">.</span><span class="nx">nativeURL</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">cwd</span><span class="p">.</span><span class="nx">nativeURL</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">theRootPath</span> <span class="o">+</span> <span class="p">(</span> <span class="nx">isAbsolute</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="s2">&quot;/&quot;</span> <span class="p">)</span> <span class="o">+</span> <span class="nx">thePath</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>returns the native file path for a given file</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getNativeFileURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFileEntry</span><span class="p">(</span>
        <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileEntry</span><span class="p">.</span><span class="nx">nativeURL</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Returns a URL for the given directory</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">getNativeDirectoryURL</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">thePath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">thePath</span> <span class="o">||</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectoryEntry</span><span class="p">(</span>
        <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">.</span><span class="nx">nativeURL</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Change to an arbitrary directory</p>

<p>Parameters:</p>

<ul>
<li><strong>theNewPath must be a String.</strong><br/>(The path to the directory, relative to cwd)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">changeDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theNewPath</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theNewPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectory</span><span class="p">(</span>
        <span class="nx">theNewDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">cwd</span> <span class="o">=</span> <span class="nx">theNewDirectory</span><span class="p">;</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">self</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Read an arbitrary file's contents.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theFilePath must be a String.</strong><br/>(The path to the file, relative to cwd)</p></li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the file (such as creating it))</p></li>
<li><p><strong>readAsKind must be a String.</strong><br/>(How to read the file -- best to use self.FILETYPE.TEXT, etc.)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">readFileContents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">readAsKind</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheFileEntry</span><span class="p">(</span>
        <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_getFileObject</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheFileObject</span><span class="p">(</span> <span class="nx">theFileObject</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_readFileContents</span><span class="p">(</span> <span class="nx">theFileObject</span><span class="p">,</span> <span class="nx">readAsKind</span> <span class="o">||</span> <span class="s2">&quot;Text&quot;</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">getTheFileContents</span><span class="p">(</span> <span class="nx">theFileContents</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theFileContents</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Read an arbitrary directory's entries.</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theDirectoryPath must be a String.</strong><br/>(The path to the directory, relative to cwd; "." if not specified)</p></li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the directory (such as creating it))</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">readDirectoryContents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theDirectoryPath</span> <span class="o">||</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span>
        <span class="kd">function</span> <span class="nx">gotTheDirectoryEntry</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">_readDirectoryContents</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span> <span class="p">);</span>
        <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheDirectoryEntries</span><span class="p">(</span> <span class="nx">theEntries</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theEntries</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Write data to an arbitrary file</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theFilePath must be a String.</strong><br/>(The file name to write to, relative to cwd)</p></li>
<li><p><strong>options must be an Object.</strong><br/>(The options to use when opening the file)</p></li>
<li><p><strong>theData must be a *.</strong><br/>(The data to write)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">writeFileContents</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">theData</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
        <span class="nx">create</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">exclusive</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheFileEntry</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_createFileWriter</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheFileWriter</span><span class="p">(</span> <span class="nx">theFileWriter</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_writeFileContents</span><span class="p">(</span> <span class="nx">theFileWriter</span><span class="p">,</span> <span class="nx">theData</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">self</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Creates an arbitrary directory</p>

<p>Parameters:</p>

<ul>
<li><strong>theDirectoryPath must be a String.</strong><br/>(The path, relative to cwd)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">createDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theDirectoryPath</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">create</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">exclusive</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectory</span><span class="p">(</span> <span class="nx">theNewDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewDirectory</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Copies a file to a new directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p></li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">copyFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">theFileToCopy</span><span class="p">;</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFileEntry</span><span class="p">(</span>
        <span class="nx">aFileToCopy</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">theFileToCopy</span> <span class="o">=</span> <span class="nx">aFileToCopy</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectoryEntry</span><span class="p">(</span> <span class="nx">theTargetDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_copyFile</span><span class="p">(</span> <span class="nx">theFileToCopy</span><span class="p">,</span> <span class="nx">theTargetDirectory</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Copies a directory to a new directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p></li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">copyDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span>
      <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">theDirectoryToCopy</span><span class="p">;</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotSourceDirectoryEntry</span><span class="p">(</span>
        <span class="nx">sourceDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">theDirectoryToCopy</span> <span class="o">=</span> <span class="nx">sourceDirectoryEntry</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTargetDirectoryEntry</span><span class="p">(</span> <span class="nx">theTargetDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_copyDirectory</span><span class="p">(</span> <span class="nx">theDirectoryToCopy</span><span class="p">,</span> <span class="nx">theTargetDirectory</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Moves a file to a new directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p></li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">moveFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">theFileToMove</span><span class="p">;</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFileEntry</span><span class="p">(</span>
        <span class="nx">aFileToMove</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">theFileToMove</span> <span class="o">=</span> <span class="nx">aFileToMove</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotDirectoryEntry</span><span class="p">(</span> <span class="nx">theTargetDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_moveFile</span><span class="p">(</span> <span class="nx">theFileToMove</span><span class="p">,</span> <span class="nx">theTargetDirectory</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Moves a directory to a new directory, with an optional new name</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p></li>
<li><p><strong>targetDirectoryPath must be a String.</strong><br/>(Path to new directory, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name, if desired)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">moveDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span>
      <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">theDirectoryToMove</span><span class="p">;</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotSourceDirectoryEntry</span><span class="p">(</span>
        <span class="nx">sourceDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">theDirectoryToMove</span> <span class="o">=</span> <span class="nx">sourceDirectoryEntry</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">targetDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTargetDirectoryEntry</span><span class="p">(</span> <span class="nx">theTargetDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_moveDirectory</span><span class="p">(</span> <span class="nx">theDirectoryToMove</span><span class="p">,</span> <span class="nx">theTargetDirectory</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">theNewDirectoryEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Renames a file to a new name, in the cwd</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">renameFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">moveFile</span><span class="p">(</span> <span class="nx">sourceFilePath</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Renames a directory to a new name, in the cwd</p>

<p>Parameters:</p>

<ul>
<li><p><strong>sourceDirectoryPath must be a String.</strong><br/>(Path to directory, relative to cwd)</p></li>
<li><p><strong>withNewName must be a String.</strong><br/>(New name)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">renameDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">moveDirectory</span><span class="p">(</span> <span class="nx">sourceDirectoryPath</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="nx">withNewName</span> <span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Deletes a file</p>

<p>Parameters:</p>

<ul>
<li><strong>theFilePath must be a String.</strong><br/>(Path to file, relative to cwd)</li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The Promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">deleteFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theFilePath</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getFileEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theFilePath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheFileToDelete</span><span class="p">(</span>
        <span class="nx">theFileEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_removeFile</span><span class="p">(</span> <span class="nx">theFileEntry</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">self</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Removes a directory, possibly recursively</p>

<p>Parameters:</p>

<ul>
<li><p><strong>theDirectoryPath must be a String.</strong><br/>(path to directory, relative to cwd)</p></li>
<li><p><strong>recursively must be a Boolean.</strong><br/>(If true, recursive remove)</p></li>
</ul>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">removeDirectory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="nx">recursively</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span><span class="p">,</span> <span class="nx">theDirectoryPath</span><span class="p">,</span> <span class="p">{}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotTheDirectoryToDelete</span><span class="p">(</span>
        <span class="nx">theDirectoryEntry</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_removeDirectory</span><span class="p">(</span> <span class="nx">theDirectoryEntry</span><span class="p">,</span> <span class="nx">recursively</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">self</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p>Asks the browser for the requested quota, and then requests the file system
and sets the cwd to the root directory.</p>

<p><strong>Returns a Promise</strong><br/>(The promise)</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">_initializeFileSystem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">_requestQuota</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">requestedQuota</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotQuota</span><span class="p">(</span>
        <span class="nx">theQuota</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_actualQuota</span> <span class="o">=</span> <span class="nx">theQuota</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_requestFileSystem</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">actualQuota</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotFS</span><span class="p">(</span> <span class="nx">theFS</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystem</span> <span class="o">=</span> <span class="nx">theFS</span><span class="p">;</span>
        <span class="c1">//self._cwd = theFS.root;</span>
        <span class="k">return</span> <span class="nx">_getDirectoryEntry</span><span class="p">(</span> <span class="nx">theFS</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">gotRootDirectory</span><span class="p">(</span> <span class="nx">theRootDirectory</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_root</span> <span class="o">=</span> <span class="nx">theRootDirectory</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_cwd</span> <span class="o">=</span> <span class="nx">theRootDirectory</span><span class="p">;</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">allDone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">self</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="k">catch</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span> <span class="nx">anError</span> <span class="p">);</span>
      <span class="p">}</span> <span class="p">).</span><span class="nx">done</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initializes the file manager with the requested file system type (self.PERSISTENT or self.TEMPORARY)
and requested quota size. Both must be specified.</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="nx">overrideSuper</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">overrideSuper</span><span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="kr">class</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">init</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">requestedQuota</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">self</span><span class="p">.</span><span class="kr">super</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="kr">super</span><span class="p">(</span> <span class="nx">_className</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span> <span class="p">);</span>
      <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>we need both:</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">fileSystemType</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
          <span class="s2">&quot;No file system type specified; specify PERSISTENT or TEMPORARY.&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">requestedQuota</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;No quota requested. If you don&#39;t know, specify ZERO.&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_requestedQuota</span> <span class="o">=</span> <span class="nx">requestedQuota</span><span class="p">;</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_fileSystemType</span> <span class="o">=</span> <span class="nx">fileSystemType</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_initializeFileSystem</span><span class="p">();</span> <span class="c1">// this returns a promise, so we can .then after.</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initializes the file manager with the requested file system type (self.PERSISTENT or self.TEMPORARY)
and requested quota size. Both must be specified.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">initWithOptions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;No options specified. Need type and quota.&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fileSystemType</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
          <span class="s2">&quot;No file system type specified; specify PERSISTENT or TEMPORARY.&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">requestedQuota</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span> <span class="s2">&quot;No quota requested. If you don&#39;t know, specify ZERO.&quot;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fileSystemType</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">requestedQuota</span> <span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">FileManager</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;00.04.450&#39;</span><span class="p">,</span>
    <span class="kr">class</span><span class="o">:</span> <span class="nx">_className</span><span class="p">,</span>
    <span class="nx">autoInitializable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">categorizable</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">FileManager</span><span class="p">;</span>
<span class="p">}</span> <span class="p">);</span></div></div></div></div></body></html>